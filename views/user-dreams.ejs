<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/output.css" />
    <script src="/script.js" defer></script>
    <title>Dream Journal</title>
  </head>
  <body class="h-screen grid grid-rows-[4rem,_1fr]">
    <% if(currentUser) console.log(currentUser) %>
    <!-- HEADER -->
    <header class="bg-secondary">
      <nav
        class="max-w-4xl h-full mx-auto flex justify-between items-center text-white"
      >
        <a class="mx-4" href="/">
          <img src="/logo_bg.png" width="200" height="75" alt="">
        </a>
        <% if(currentUser) { %>
        <div class="dropdown dropdown-hover dropdown-end">
          <label
            tabindex="0"
            class="btn mx-4 bg-secondary border-0 hover:bg-secondary-focus"
          >
            <%= currentUser.username %>
          </label>
          <ul
            tabindex="0"
            class="text-secondary-focus dropdown-content menu p-2 bg-base-100 rounded-box w-52 shadow-xl"
          >
          <li><a href="/new-dream">Record Dream</a></li>
            <li><a href="/dreams/<%= currentUser.id %>">Dream Journal</a></li>
            <li><a href="/log-out">Sign out</a></li>
          </ul>
        </div>
        <% } else { %>
        <!-- The button to open modal -->
        <label for="my-modal-4" class="btn btn-secondary mx-4"> Account </label>
        <% } %>
      </nav>
    </header>
    <div class="bg-base-200">
      <section class="max-w-4xl mx-auto">
        <h1 class="text-5xl font-bold my-8 text-center">Dream Journal</h1>
        <% if (!dreams.length) { %>
          <div class="my-8 flex flex-col gap-8 justify-center">
            <p class="text-center">No dreams recorded!</p>
            <a href="/new-dream" class="text-center link link-hover link-primary w-full mx-auto ">Record a dream</a>
          </div>
          <% } else if(currentUser?.id == dreams[0]?.author.toString()) {%>
        <section class="flex flex-col gap-4">
        <% for (let dream of dreams) { %>
          <div tabindex="0" class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
            <div class="collapse-title text-xl font-medium">
              <%= dream.prompt %>
            </div>
            <div class="collapse-content">
              <p class="m-2 font-semibold"><%= dream.date %></p>
              <p><%= dream.response %></p>
            </div>
            <div class="flex">
                <button data-delete_dream value="<%= dream._id %>" class="w-full rounded-none btn btn-error text-white text-end">Delete</button>
              </div>
          </div>
            <% } %> 
          </section>
          <% } else { %>
        <h1 class="text-5xl font-bold my-6 text-center">
          Please log in to see your recorded dreams
        </h1>

        <% } %>
      </section>
    </div>

    <!-- MODAL -->
    <input type="checkbox" id="my-modal-4" class="modal-toggle" />
    <label for="my-modal-4" class="modal cursor-pointer">
      <label id="user-modal" class="modal-box relative" for=""> </label>
    </label>
    <!-- Register form -->
    <template id="register-form">
      <h3 class="text-xl font-bold">Sign up for an account</h3>
      <form class="form-control" id="registration-form">
        <label class="label" for="username">Username</label>
        <input
          id="username-input"
          class="input input-bordered"
          name="username"
          placeholder="username"
          type="text"
        />
        <span
          id="register-warning"
          class="label-text text-error hidden h-0 text-right"
          >Sorry, username is taken!</span
        >
        <label class="label" for="password">Password</label>
        <input
          class="input input-bordered"
          name="password"
          placeholder="password"
          type="text"
        />
        <button class="btn btn-secondary my-4">Sign Up</button>
      </form>
      <button class="link link-hover" value="log-in-form" data-modal_switcher>
        Log in to your account
      </button>
    </template>
    <!-- Log in form -->
    <template id="log-in-form">
      <h3 class="text-xl font-bold">Sign in</h3>
      <form class="form-control" action="/log-in" method="POST">
        <label class="label" for="username">Username</label>
        <input
          class="input input-bordered"
          name="username"
          placeholder="username"
          type="text"
        />
        <label class="label" for="password">Password</label>
        <input
          class="input input-bordered"
          name="password"
          type="password"
          placeholder="password"
        />
        <button class="btn btn-secondary my-4">Log In</button>
      </form>
      <button class="link link-hover" value="register-form" data-modal_switcher>
        Sign up for an account
      </button>
    </template>
  </body>
</html>
